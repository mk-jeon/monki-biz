<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>가맹점현황 - MONKi Biz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <div class="bg-white shadow-sm border-b sticky top-0 z-50">
        <div class="max-w-full mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">
                        <i class="fas fa-building mr-2 text-indigo-500"></i> 가맹점현황
                    </h1>
                    <p class="text-sm text-gray-500 mt-1">가맹점 리스트 및 상태 관리</p>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="refreshData()" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button onclick="window.location.href='/dashboard'" class="text-gray-600 hover:text-gray-800">
                        <i class="fas fa-home text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="p-6">
        <div class="bg-white rounded-xl shadow-md overflow-hidden">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">가맹점명</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">대표자</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">연락처</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">지역</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">상태</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">등록일</th>
                    </tr>
                </thead>
                <tbody id="franchiseTable" class="bg-white divide-y divide-gray-200">
                    <tr>
                        <td colspan="7" class="px-6 py-20 text-center text-gray-500">데이터를 불러오는 중...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            await checkSession();
            await loadData();
        });
        
        async function checkSession() {
            try {
                await axios.get('/api/auth/session');
            } catch (error) {
                alert('로그인이 필요합니다.');
                window.location.href = '/';
            }
        }

        async function loadData() {
            try {
                const response = await axios.get('/api/franchises');
                const data = response.data || [];
                renderTable(data);
            } catch (error) {
                console.error('데이터 로드 실패:', error);
                document.getElementById('franchiseTable').innerHTML = '<tr><td colspan="7" class="px-6 py-20 text-center text-gray-500">데이터를 불러오는데 실패했습니다.</td></tr>';
            }
        }

        function renderTable(data) {
            const tbody = document.getElementById('franchiseTable');
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="px-6 py-20 text-center text-gray-500">등록된 가맹점이 없습니다.</td></tr>';
                return;
            }
            tbody.innerHTML = data.map(item => `
                <tr class="hover:bg-gray-50 cursor-pointer" onclick="alert('상세보기 ID: ${item.id}')">
                    <td class="px-6 py-4 text-sm text-gray-900">${item.id}</td>
                    <td class="px-6 py-4 text-sm font-medium text-gray-900">${item.franchise_name || '-'}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${item.representative || '-'}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${item.phone || '-'}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${item.region || '-'}</td>
                    <td class="px-6 py-4 text-sm">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                            ${item.status || '운영중'}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-500">${formatDate(item.created_at)}</td>
                </tr>
            `).join('');
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            return new Date(dateString).toLocaleDateString('ko-KR');
        }

        async function refreshData() { await loadData(); }
    </script>
</body>
</html>
